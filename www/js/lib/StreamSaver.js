(definition=>{"undefined"!=typeof module?module.exports=definition():"function"==typeof define&&"object"==typeof define.amd?define(definition):this.streamSaver=definition()})(()=>{"use strict";var global="object"==typeof window?window:this,mitmTransporter=(global.HTMLElement||console.warn("streamsaver is meant to run on browsers main thread"),null),supportsTransferable=!1,ponyfill=global.WebStreamsPolyfill||{},isSecureContext=global.isSecureContext,useBlobFallback=/constructor/i.test(global.HTMLElement)||!!global.safari||!!global.WebKitPoint,downloadStrategy=isSecureContext||"MozAppearance"in document.documentElement.style?"iframe":"navigate",streamSaver={createWriteStream:function(filename,options,size){var opts={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},bytesWritten=0,downloadUrl=null,channel=null,ts=null;Number.isFinite(options)?([size,options]=[options,size],console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),opts.size=size,opts.writableStrategy=options):options&&options.highWaterMark?(console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),opts.size=size,opts.writableStrategy=options):opts=options||{};{var args;useBlobFallback||(mitmTransporter=mitmTransporter||(isSecureContext?makeIframe:function(src){var delegate=document.createDocumentFragment(),popup={frame:global.open(src,"popup","width=200,height=100"),loaded:!1,isIframe:!1,isPopup:!0,remove(){popup.frame.close()},addEventListener(...args){delegate.addEventListener(...args)},dispatchEvent(...args){delegate.dispatchEvent(...args)},removeEventListener(...args){delegate.removeEventListener(...args)},postMessage(...args){popup.frame.postMessage(...args)}},onReady=evt=>{evt.source===popup.frame&&(popup.loaded=!0,global.removeEventListener("message",onReady),popup.dispatchEvent(new Event("load")))};return global.addEventListener("message",onReady),popup})(streamSaver.mitm),channel=new MessageChannel,filename=encodeURIComponent(filename.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A"),size={transferringReadable:supportsTransferable,pathname:opts.pathname||Math.random().toString().slice(-6)+"/"+filename,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+filename}},opts.size&&(size.headers["Content-Length"]=opts.size),args=[size,"*",[channel.port2]],supportsTransferable&&(options="iframe"==downloadStrategy?void 0:{transform(chunk,controller){if(!(chunk instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");bytesWritten+=chunk.length,controller.enqueue(chunk),downloadUrl&&(location.href=downloadUrl,downloadUrl=null)},flush(){downloadUrl&&(location.href=downloadUrl)}},size=(ts=new streamSaver.TransformStream(options,opts.writableStrategy,opts.readableStrategy)).readable,channel.port1.postMessage({readableStream:size},[size])),channel.port1.onmessage=evt=>{evt.data.download?"navigate"==downloadStrategy?(mitmTransporter.remove(),mitmTransporter=null,bytesWritten?location.href=evt.data.download:downloadUrl=evt.data.download):(mitmTransporter.isPopup&&(mitmTransporter.remove(),mitmTransporter=null,"iframe"==downloadStrategy)&&makeIframe(streamSaver.mitm),makeIframe(evt.data.download)):evt.data.abort&&(chunks=[],channel.port1.postMessage("abort"),channel.port1.onmessage=null,channel.port1.close(),channel.port2.close(),channel=null)},mitmTransporter.loaded?mitmTransporter.postMessage(...args):mitmTransporter.addEventListener("load",()=>{mitmTransporter.postMessage(...args)},{once:!0}))}var chunks=[];return!useBlobFallback&&ts&&ts.writable||new streamSaver.WritableStream({write(chunk){if(!(chunk instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");useBlobFallback?chunks.push(chunk):(channel.port1.postMessage(chunk),bytesWritten+=chunk.length,downloadUrl&&(location.href=downloadUrl,downloadUrl=null))},close(){var blob,link;useBlobFallback?(blob=new Blob(chunks,{type:"application/octet-stream; charset=utf-8"}),(link=document.createElement("a")).href=URL.createObjectURL(blob),link.download=filename,link.click()):channel.port1.postMessage("end")},abort(){chunks=[],channel.port1.postMessage("abort"),channel.port1.onmessage=null,channel.port1.close(),channel.port2.close(),channel=null}},opts.writableStrategy)},WritableStream:global.WritableStream||ponyfill.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"./mitm.html"};function makeIframe(src){var iframe;if(src)return(iframe=document.createElement("iframe")).hidden=!0,iframe.src=src,iframe.loaded=!1,iframe.name="iframe",iframe.isIframe=!0,iframe.postMessage=(...args)=>iframe.contentWindow.postMessage(...args),iframe.addEventListener("load",()=>{iframe.loaded=!0},{once:!0}),document.body.appendChild(iframe),iframe;throw new Error("meh")}try{new Response(new ReadableStream),!isSecureContext||"serviceWorker"in navigator||(useBlobFallback=!0)}catch(err){useBlobFallback=!0}ponyfill=()=>{var readable=(new TransformStream)["readable"],mc=new MessageChannel;mc.port1.postMessage(readable,[readable]),mc.port1.close(),mc.port2.close(),supportsTransferable=!0,Object.defineProperty(streamSaver,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})};try{ponyfill()}catch(e){}return streamSaver});